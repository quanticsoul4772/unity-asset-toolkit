# NPCBrain Architecture Diagrams

**Version:** 1.0  
**Status:** Planning  
**Last Updated:** January 2026

## Purpose

Visual blueprints showing how NPCBrain systems connect and data flows through the AI brain.

---

## 1. High-Level System Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              NPCBrain Component                                  │
│                                                                                  │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│  │  PERCEIVE   │───▶│    THINK    │───▶│   DECIDE    │───▶│     ACT     │      │
│  │             │    │             │    │             │    │             │      │
│  │ • Sight     │    │ • Blackboard│    │ • Behavior  │    │ • Movement  │      │
│  │ • Hearing   │    │ • Memory    │    │   Tree      │    │ • Animation │      │
│  │ • Proximity │    │ • Emotions  │    │ • Utility AI│    │ • Combat    │      │
│  │             │    │ • Beliefs   │    │ • Criticality│   │ • Interact  │      │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘      │
│         │                  ▲                  │                  │              │
│         │                  │                  │                  │              │
│         └──────────────────┴──────────────────┴──────────────────┘              │
│                              Feedback Loop                                       │
└─────────────────────────────────────────────────────────────────────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    ▼                 ▼                 ▼
            ┌─────────────┐   ┌─────────────┐   ┌─────────────┐
            │  EasyPath   │   │  SwarmAI    │   │   Unity     │
            │ Pathfinding │   │  Steering   │   │  Animator   │
            └─────────────┘   └─────────────┘   └─────────────┘
```

---

## 2. Complete Component Wiring Diagram

```
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│                                    NPCBrain                                               │
│                                                                                           │
│  ╔═══════════════════════════════════════════════════════════════════════════════════╗  │
│  ║                              PERCEPTION LAYER                                      ║  │
│  ╠═══════════════════════════════════════════════════════════════════════════════════╣  │
│  ║                                                                                    ║  │
│  ║   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                        ║  │
│  ║   │ SightSensor  │    │HearingSensor │    │ProximitySensor│                       ║  │
│  ║   │              │    │              │    │              │                        ║  │
│  ║   │ • FOV: 120°  │    │ • Range: 15m │    │ • Range: 5m  │                        ║  │
│  ║   │ • Range: 20m │    │ • Threshold  │    │ • LayerMask  │                        ║  │
│  ║   │ • Raycasts   │    │              │    │              │                        ║  │
│  ║   └──────┬───────┘    └──────┬───────┘    └──────┬───────┘                        ║  │
│  ║          │                   │                   │                                 ║  │
│  ║          └───────────────────┼───────────────────┘                                 ║  │
│  ║                              ▼                                                     ║  │
│  ║                    ┌─────────────────┐         ┌─────────────────┐                ║  │
│  ║                    │ PerceptionSystem│────────▶│  TargetSelector │                ║  │
│  ║                    │                 │         │                 │                ║  │
│  ║                    │ Aggregates all  │         │ Picks best      │                ║  │
│  ║                    │ sensor data     │         │ target by score │                ║  │
│  ║                    └────────┬────────┘         └────────┬────────┘                ║  │
│  ║                             │                           │                          ║  │
│  ╚═════════════════════════════╪═══════════════════════════╪══════════════════════════╝  │
│                                │                           │                             │
│                                ▼                           ▼                             │
│  ╔═══════════════════════════════════════════════════════════════════════════════════╗  │
│  ║                              KNOWLEDGE LAYER                                       ║  │
│  ╠═══════════════════════════════════════════════════════════════════════════════════╣  │
│  ║                                                                                    ║  │
│  ║   ┌──────────────────────────────────────────────────────────────────────────┐    ║  │
│  ║   │                            BLACKBOARD                                     │    ║  │
│  ║   │                                                                           │    ║  │
│  ║   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │    ║  │
│  ║   │  │   target    │  │lastKnownPos │  │ alertLevel  │  │   health    │      │    ║  │
│  ║   │  │ GameObject  │  │  Vector3    │  │    int      │  │   float     │      │    ║  │
│  ║   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │    ║  │
│  ║   │                                                                           │    ║  │
│  ║   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │    ║  │
│  ║   │  │homePosition │  │  waypoints  │  │ threatLevel │  │    ammo     │      │    ║  │
│  ║   │  │  Vector3    │  │   List<>    │  │   float     │  │    int      │      │    ║  │
│  ║   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘      │    ║  │
│  ║   └──────────────────────────────────────────────────────────────────────────┘    ║  │
│  ║                                         │                                          ║  │
│  ║         ┌───────────────────────────────┼───────────────────────────────┐         ║  │
│  ║         ▼                               ▼                               ▼         ║  │
│  ║   ┌───────────┐                  ┌───────────┐                  ┌───────────┐     ║  │
│  ║   │  Memory   │                  │ Emotions  │                  │  Beliefs  │     ║  │
│  ║   │           │                  │           │                  │           │     ║  │
│  ║   │ • Targets │                  │ • PAD     │                  │ • Target  │     ║  │
│  ║   │ • Decay   │                  │ • Baseline│                  │   beliefs │     ║  │
│  ║   │ • LastSeen│                  │ • Current │                  │ • Confidence│   ║  │
│  ║   └───────────┘                  └───────────┘                  └───────────┘     ║  │
│  ║                                                                                    ║  │
│  ╚════════════════════════════════════════╪═══════════════════════════════════════════╝  │
│                                            │                                             │
│                                            ▼                                             │
│  ╔═══════════════════════════════════════════════════════════════════════════════════╗  │
│  ║                              DECISION LAYER                                        ║  │
│  ╠═══════════════════════════════════════════════════════════════════════════════════╣  │
│  ║                                                                                    ║  │
│  ║   ┌─────────────────────────────────────────────────────────────────────────┐     ║  │
│  ║   │                         DECISION SYSTEM                                  │     ║  │
│  ║   │                                                                          │     ║  │
│  ║   │    ┌─────────────────┐              ┌─────────────────┐                 │     ║  │
│  ║   │    │  BEHAVIOR TREE  │     OR       │   UTILITY AI    │                 │     ║  │
│  ║   │    │                 │              │                 │                 │     ║  │
│  ║   │    │  Selector       │              │  Action Scoring │                 │     ║  │
│  ║   │    │  ├─ Combat      │              │  • Patrol: 0.72 │                 │     ║  │
│  ║   │    │  ├─ Investigate │              │  • Chase:  0.65 │                 │     ║  │
│  ║   │    │  └─ Patrol      │              │  • Attack: 0.45 │                 │     ║  │
│  ║   │    │                 │              │  • Flee:   0.20 │                 │     ║  │
│  ║   │    └────────┬────────┘              └────────┬────────┘                 │     ║  │
│  ║   │             │                                │                          │     ║  │
│  ║   │             └────────────────┬───────────────┘                          │     ║  │
│  ║   │                              ▼                                          │     ║  │
│  ║   │             ┌─────────────────────────────────┐                         │     ║  │
│  ║   │             │    CRITICALITY CONTROLLER       │                         │     ║  │
│  ║   │             │                                 │                         │     ║  │
│  ║   │             │  Metrics:                       │                         │     ║  │
│  ║   │             │  • Entropy    ████░░ 0.52       │                         │     ║  │
│  ║   │             │  • Churn      ██░░░░ 0.24       │                         │     ║  │
│  ║   │             │  • Surprise   ███░░░ 0.38       │                         │     ║  │
│  ║   │             │                                 │                         │     ║  │
│  ║   │             │  Knobs:                         │                         │     ║  │
│  ║   │             │  • Temperature: 1.2             │                         │     ║  │
│  ║   │             │  • Inertia: 0.35                │                         │     ║  │
│  ║   │             │  • Attention: 6                 │                         │     ║  │
│  ║   │             └─────────────────────────────────┘                         │     ║  │
│  ║   │                              │                                          │     ║  │
│  ║   └──────────────────────────────┼──────────────────────────────────────────┘     ║  │
│  ║                                  │                                                 ║  │
│  ╚══════════════════════════════════╪═════════════════════════════════════════════════╝  │
│                                     │                                                    │
│                                     ▼                                                    │
│  ╔═══════════════════════════════════════════════════════════════════════════════════╗  │
│  ║                              TACTICAL LAYER                                        ║  │
│  ╠═══════════════════════════════════════════════════════════════════════════════════╣  │
│  ║                                                                                    ║  │
│  ║   ┌───────────────┐     ┌───────────────┐     ┌───────────────┐                   ║  │
│  ║   │ Influence Maps│     │Context Steering│    │TacticalPosition│                  ║  │
│  ║   │               │     │               │     │               │                   ║  │
│  ║   │ • Threat Map  │────▶│ • Interest[]  │────▶│ • Find Cover  │                   ║  │
│  ║   │ • Territory   │     │ • Danger[]    │     │ • Flank       │                   ║  │
│  ║   │ • Interest    │     │ • Best Dir    │     │ • Retreat     │                   ║  │
│  ║   └───────────────┘     └───────────────┘     └───────────────┘                   ║  │
│  ║                                                       │                            ║  │
│  ╚═══════════════════════════════════════════════════════╪════════════════════════════╝  │
│                                                          │                               │
│                                                          ▼                               │
│  ╔═══════════════════════════════════════════════════════════════════════════════════╗  │
│  ║                              ACTION LAYER                                          ║  │
│  ╠═══════════════════════════════════════════════════════════════════════════════════╣  │
│  ║                                                                                    ║  │
│  ║   ┌───────────────┐     ┌───────────────┐     ┌───────────────┐                   ║  │
│  ║   │  MoveTo       │     │  Attack       │     │  Investigate  │                   ║  │
│  ║   └───────┬───────┘     └───────┬───────┘     └───────┬───────┘                   ║  │
│  ║           │                     │                     │                            ║  │
│  ║           └─────────────────────┼─────────────────────┘                            ║  │
│  ║                                 ▼                                                  ║  │
│  ║                    ┌─────────────────────────┐                                    ║  │
│  ║                    │    AnimatorBridge       │                                    ║  │
│  ║                    │                         │                                    ║  │
│  ║                    │ • SetTrigger()          │                                    ║  │
│  ║                    │ • SetFloat()            │                                    ║  │
│  ║                    │ • SetLookAtTarget()     │                                    ║  │
│  ║                    └─────────────────────────┘                                    ║  │
│  ║                                                                                    ║  │
│  ╚════════════════════════════════════════════════════════════════════════════════════╝  │
│                                                                                           │
└───────────────────────────────────────────────────────────────────────────────────────────┘
                    │                           │                           │
                    ▼                           ▼                           ▼
          ┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
          │    EasyPath     │         │     SwarmAI     │         │  Unity Animator │
          │   Integration   │         │   Integration   │         │                 │
          │                 │         │                 │         │                 │
          │ • RequestPath() │         │ • GetSteering() │         │ • Parameters    │
          │ • FollowPath()  │         │ • Separation    │         │ • Triggers      │
          │                 │         │ • Alignment     │         │ • IK Targets    │
          └─────────────────┘         └─────────────────┘         └─────────────────┘
```

---

## 3. Data Flow Per Tick

```
                                    TICK CYCLE
                                    
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   1. SENSE                                                              │
    │   ───────                                                               │
    │                                                                         │
    │   SightSensor ─────┐                                                   │
    │                    │                                                    │
    │   HearingSensor ───┼──▶ PerceptionSystem ──▶ TargetSelector            │
    │                    │           │                   │                    │
    │   ProximitySensor ─┘           │                   │                    │
    │                                ▼                   ▼                    │
    │                          ┌─────────┐        ┌──────────────┐           │
    │                          │ Memory  │        │ CurrentTarget│           │
    │                          │ Update  │        │   Selected   │           │
    │                          └────┬────┘        └──────┬───────┘           │
    │                               │                    │                    │
    └───────────────────────────────┼────────────────────┼────────────────────┘
                                    │                    │
                                    ▼                    ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   2. THINK                                                              │
    │   ────────                                                              │
    │                                                                         │
    │   ┌────────────────────────────────────────────────────────────────┐   │
    │   │                      BLACKBOARD UPDATE                          │   │
    │   │                                                                 │   │
    │   │  target ← CurrentTarget                                        │   │
    │   │  lastKnownPosition ← Memory.GetLastPosition(target)           │   │
    │   │  alertLevel ← CalculateAlertLevel(threats)                    │   │
    │   │  threatLevel ← PerceptionSystem.GetThreatLevel()              │   │
    │   └────────────────────────────────────────────────────────────────┘   │
    │                               │                                         │
    │                               ▼                                         │
    │   ┌────────────────────────────────────────────────────────────────┐   │
    │   │                      EMOTIONS UPDATE                            │   │
    │   │                                                                 │   │
    │   │  if (tookDamage) Emotions.ApplyEvent(DamageEvent)              │   │
    │   │  if (killedEnemy) Emotions.ApplyEvent(VictoryEvent)            │   │
    │   │  Emotions.Update(deltaTime)  // decay toward baseline          │   │
    │   └────────────────────────────────────────────────────────────────┘   │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   3. DECIDE                                                             │
    │   ─────────                                                             │
    │                                                                         │
    │   ┌────────────────────────────────────────────────────────────────┐   │
    │   │                    BEHAVIOR TREE TICK                           │   │
    │   │                         OR                                      │   │
    │   │                    UTILITY AI SCORE                             │   │
    │   │                                                                 │   │
    │   │   Read Blackboard ─────▶ Evaluate Conditions ─────▶ Select Node│   │
    │   │                                    │                            │   │
    │   │                                    ▼                            │   │
    │   │                         ┌─────────────────┐                    │   │
    │   │                         │ Selected Action │                    │   │
    │   │                         │   e.g. "Chase"  │                    │   │
    │   │                         └─────────────────┘                    │   │
    │   └────────────────────────────────┬───────────────────────────────┘   │
    │                                    │                                    │
    │                                    ▼                                    │
    │   ┌────────────────────────────────────────────────────────────────┐   │
    │   │                   CRITICALITY ADJUSTMENT                        │   │
    │   │                                                                 │   │
    │   │   Record action in telemetry                                   │   │
    │   │   Compute metrics (entropy, churn, surprise)                   │   │
    │   │   Adjust knobs (temperature, inertia)                          │   │
    │   │   Apply to next decision                                       │   │
    │   └────────────────────────────────────────────────────────────────┘   │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   4. PLAN (Tactical)                                                    │
    │   ──────────────────                                                    │
    │                                                                         │
    │   ┌────────────────────────────────────────────────────────────────┐   │
    │   │                    TACTICAL POSITIONING                         │   │
    │   │                                                                 │   │
    │   │   Influence Maps ───▶ Evaluate positions ───▶ Best position   │   │
    │   │                                                                 │   │
    │   │   Context Steering ───▶ Sample directions ───▶ Best direction │   │
    │   └────────────────────────────────────────────────────────────────┘   │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   5. ACT                                                                │
    │   ──────                                                                │
    │                                                                         │
    │   ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │
    │   │    MOVEMENT     │  │    ANIMATION    │  │     COMBAT      │        │
    │   │                 │  │                 │  │                 │        │
    │   │ EasyPath.MoveTo │  │ Animator.Set()  │  │ Fire weapon     │        │
    │   │ SwarmAI.Steer() │  │ LookAt target   │  │ Deal damage     │        │
    │   └─────────────────┘  └─────────────────┘  └─────────────────┘        │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Behavior Tree + Utility AI Hybrid

```
                           HYBRID DECISION SYSTEM
                           
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                        BEHAVIOR TREE (Structure)                        │
    │                                                                         │
    │                              ┌─────────┐                               │
    │                              │ Selector│                               │
    │                              └────┬────┘                               │
    │               ┌──────────────────┼──────────────────┐                  │
    │               │                  │                  │                  │
    │               ▼                  ▼                  ▼                  │
    │        ┌───────────┐      ┌───────────┐      ┌───────────┐            │
    │        │  Combat   │      │Investigate│      │  Patrol   │            │
    │        │ Sequence  │      │ Sequence  │      │ Sequence  │            │
    │        └─────┬─────┘      └─────┬─────┘      └─────┬─────┘            │
    │              │                  │                  │                   │
    │              ▼                  ▼                  ▼                   │
    │     ┌────────────────┐  ┌────────────────┐  ┌────────────────┐        │
    │     │ CheckTarget    │  │ CheckSound     │  │ CheckWaypoint  │        │
    │     │ Visible?       │  │ Heard?         │  │ Available?     │        │
    │     └───────┬────────┘  └───────┬────────┘  └───────┬────────┘        │
    │             │ Yes              │ Yes              │ Yes               │
    │             ▼                  ▼                  ▼                   │
    │     ╔════════════════╗  ┌────────────────┐  ┌────────────────┐        │
    │     ║  UTILITY AI    ║  │  Investigate   │  │  MoveToWaypoint│        │
    │     ║  SELECTOR      ║  │  Action        │  │  Action        │        │
    │     ║                ║  └────────────────┘  └────────────────┘        │
    │     ║  Scores:       ║                                                │
    │     ║  • Attack: 0.7 ║◀──── Blackboard data + Emotion + Criticality  │
    │     ║  • Chase:  0.6 ║                                                │
    │     ║  • Flee:   0.2 ║                                                │
    │     ║  • Cover:  0.4 ║                                                │
    │     ║                ║                                                │
    │     ║  Winner: Attack║                                                │
    │     ╚═══════╤════════╝                                                │
    │             │                                                          │
    │             ▼                                                          │
    │     ┌────────────────┐                                                │
    │     │ Execute Attack │                                                │
    │     │ Action         │                                                │
    │     └────────────────┘                                                │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
    
    
                        WHY HYBRID?
    
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   BEHAVIOR TREE provides:                                              │
    │   • Clear high-level structure (combat vs patrol vs investigate)       │
    │   • Priority ordering (combat > investigate > patrol)                  │
    │   • Easy to understand flow                                            │
    │   • Conditional aborts                                                 │
    │                                                                         │
    │   UTILITY AI provides:                                                 │
    │   • Nuanced decisions within combat (attack vs flee vs cover)          │
    │   • Emergent behavior from score combinations                          │
    │   • Easy to add new actions without restructuring tree                 │
    │   • Criticality integration (temperature, inertia)                     │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Perception System Detail

```
                           PERCEPTION PIPELINE
                           
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │  WORLD                    SENSORS                     PROCESSED        │
    │                                                                         │
    │  ┌─────────┐                                                           │
    │  │ Player  │             ┌─────────────────┐                          │
    │  │ (enemy) │────────────▶│  SIGHT SENSOR   │                          │
    │  └─────────┘             │                 │                          │
    │       │                  │  1. Distance    │        ┌───────────────┐ │
    │       │                  │     check       │        │               │ │
    │       │                  │  2. Angle       │───────▶│   PERCEIVED   │ │
    │       │                  │     check (FOV) │        │   TARGET      │ │
    │       │                  │  3. Raycast     │        │               │ │
    │       │                  │     (obstacles) │        │ • GameObject  │ │
    │       │                  │  4. Visibility  │        │ • Position    │ │
    │       │                  │     score 0-1   │        │ • Visibility  │ │
    │       │                  └─────────────────┘        │ • Distance    │ │
    │       │                                             │ • LastSeen    │ │
    │       │                                             │ • Threat      │ │
    │       │                  ┌─────────────────┐        │               │ │
    │       │                  │ HEARING SENSOR  │        └───────┬───────┘ │
    │       │                  │                 │                │         │
    │  ┌────┴────┐             │  1. Distance    │                │         │
    │  │ Footstep│────────────▶│     check      │────────────────┤         │
    │  │ Sound   │             │  2. Loudness    │                │         │
    │  └─────────┘             │     threshold   │                │         │
    │                          │  3. Attribution │                │         │
    │                          │     (hostile?)  │                │         │
    │                          └─────────────────┘                │         │
    │                                                             │         │
    │                          ┌─────────────────┐                │         │
    │  ┌─────────┐             │ PROXIMITY SENSOR│                │         │
    │  │ NPC #2  │────────────▶│                 │────────────────┤         │
    │  │ (ally)  │             │  Range check    │                │         │
    │  └─────────┘             │  Layer filter   │                │         │
    │                          └─────────────────┘                │         │
    │                                                             │         │
    │                                                             ▼         │
    │                                             ┌───────────────────────┐ │
    │                                             │  PERCEPTION SYSTEM    │ │
    │                                             │                       │ │
    │                                             │  AllPerceivedTargets  │ │
    │                                             │  ┌───┬───┬───┬───┐   │ │
    │                                             │  │ T1│ T2│ T3│ T4│   │ │
    │                                             │  └───┴───┴───┴───┘   │ │
    │                                             │          │            │ │
    │                                             └──────────┼────────────┘ │
    │                                                        │              │
    │                                                        ▼              │
    │                                             ┌───────────────────────┐ │
    │                                             │   TARGET SELECTOR     │ │
    │                                             │                       │ │
    │                                             │  Score each target:   │ │
    │                                             │  • Distance weight    │ │
    │                                             │  • Threat weight      │ │
    │                                             │  • Visibility weight  │ │
    │                                             │  • Health weight      │ │
    │                                             │                       │ │
    │                                             │  Selected: Player     │ │
    │                                             └───────────────────────┘ │
    │                                                        │              │
    │                                                        ▼              │
    │                                             ┌───────────────────────┐ │
    │                                             │       MEMORY          │ │
    │                                             │                       │ │
    │                                             │  Remember position    │ │
    │                                             │  Decay over time      │ │
    │                                             │  Max memories: 10     │ │
    │                                             └───────────────────────┘ │
    │                                                                       │
    └───────────────────────────────────────────────────────────────────────┘
```

---

## 6. Criticality Feedback Loop

```
                        CRITICALITY CONTROL LOOP
                        
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                           TELEMETRY                                     │
    │                                                                         │
    │   Every action/decision is recorded in ring buffers:                   │
    │                                                                         │
    │   Action History:     [A][B][A][A][C][A][B][A][A][A][B][A][A][...]     │
    │   Plan History:       [P1][P1][P1][P2][P2][P1][P1][P3][P3][P3][...]    │
    │   Prediction Errors:  [0.1][0.3][0.0][0.5][0.2][0.1][0.4][...]         │
    │   State History:      [Patrol][Patrol][Combat][Combat][Patrol][...]    │
    │                                                                         │
    └────────────────────────────────────┬────────────────────────────────────┘
                                         │
                                         ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                        METRIC COMPUTATION                               │
    │                        (every 5-10 ticks)                               │
    │                                                                         │
    │   ┌───────────────┐  ┌───────────────┐  ┌───────────────┐             │
    │   │ Action Entropy│  │  Plan Churn   │  │   Surprise    │             │
    │   │               │  │               │  │               │             │
    │   │ H = -Σp·log(p)│  │ changes / N-1 │  │ avg |Δ pred|  │             │
    │   │               │  │               │  │               │             │
    │   │ ████████░░    │  │ ████░░░░░░    │  │ ██████░░░░    │             │
    │   │    0.52       │  │    0.24       │  │    0.38       │             │
    │   └───────────────┘  └───────────────┘  └───────────────┘             │
    │                                                                         │
    └────────────────────────────────────┬────────────────────────────────────┘
                                         │
                                         ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                        CHAOS INDEX                                      │
    │                                                                         │
    │   chaos = w₁·entropy + w₂·churn + w₃·surprise + w₄·volatility         │
    │         = 1.0·0.52 + 0.8·0.24 + 1.0·0.38 + 0.6·0.18                    │
    │         = 0.52 + 0.19 + 0.38 + 0.11                                    │
    │         = 1.20 / 3.4 (normalized)                                      │
    │         = 0.35                                                          │
    │                                                                         │
    │   Target Band: [0.40 ─────────────────── 0.55]                         │
    │                                                                         │
    │   Current:  ◀─── 0.35 (TOO ORDERED)                                    │
    │             ░░░░░░░│░░░░░░░░░░░░░░░░░░░░░░░░                           │
    │             0.0  0.35 0.40            0.55  1.0                         │
    │                                                                         │
    └────────────────────────────────────┬────────────────────────────────────┘
                                         │
                                         ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                        KNOB ADJUSTMENT                                  │
    │                                                                         │
    │   Since chaos < target_low (0.35 < 0.40):                              │
    │   → NPC is TOO PREDICTABLE                                             │
    │   → Need MORE exploration                                               │
    │                                                                         │
    │   Adjustments:                                                          │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │  Temperature:  1.0 ──▶ 1.1   (+0.1)  More randomness           │  │
    │   │  Inertia:      0.4 ──▶ 0.35  (-0.05) Easier to switch plans    │  │
    │   │  Attention:    5   ──▶ 6     (+1)    Consider more options     │  │
    │   │  Coupling:     0.6 ──▶ 0.55  (-0.05) Less herd behavior        │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    └────────────────────────────────────┬────────────────────────────────────┘
                                         │
                                         ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                        UTILITY AI INTEGRATION                           │
    │                                                                         │
    │   Action scores before temperature:                                     │
    │   Patrol: 0.72,  Chase: 0.65,  Attack: 0.45,  Flee: 0.20               │
    │                                                                         │
    │   After softmax with temperature=1.1:                                  │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │  Patrol:  ████████████████████░░░░  58% (was 65% with T=1.0)   │  │
    │   │  Chase:   █████████████░░░░░░░░░░░  32% (was 28% with T=1.0)   │  │
    │   │  Attack:  ████░░░░░░░░░░░░░░░░░░░░   8% (was 6%  with T=1.0)   │  │
    │   │  Flee:    █░░░░░░░░░░░░░░░░░░░░░░░   2% (was 1%  with T=1.0)   │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    │   Higher temperature = more probability spread = more exploration       │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Integration with External Systems

```
                        EXTERNAL SYSTEM INTEGRATION
                        
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                              NPCBrain                                   │
    │                                                                         │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │                        DECISION                                  │  │
    │   │                                                                  │  │
    │   │   "I want to move to position X"                                │  │
    │   │   "I want to attack target Y"                                   │  │
    │   │   "I want to flee in direction Z"                               │  │
    │   │                                                                  │  │
    │   └────────────────────────────┬────────────────────────────────────┘  │
    │                                │                                        │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │                     BRIDGE LAYER                                 │  │
    │   │                                                                  │  │
    │   │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐       │  │
    │   │  │EasyPathBridge │  │ SwarmAIBridge │  │AnimatorBridge │       │  │
    │   │  │               │  │               │  │               │       │  │
    │   │  │ Checks if     │  │ Checks if     │  │ Always        │       │  │
    │   │  │ EasyPath      │  │ SwarmAI       │  │ available     │       │  │
    │   │  │ available     │  │ available     │  │               │       │  │
    │   │  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘       │  │
    │   │          │                  │                  │                │  │
    │   └──────────┼──────────────────┼──────────────────┼────────────────┘  │
    │              │                  │                  │                    │
    └──────────────┼──────────────────┼──────────────────┼────────────────────┘
                   │                  │                  │
                   ▼                  ▼                  ▼
    
    ┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐
    │     EASYPATH      │   │      SWARMAI      │   │   UNITY ANIMATOR  │
    │                   │   │                   │   │                   │
    │   IF AVAILABLE:   │   │   IF AVAILABLE:   │   │   ALWAYS:         │
    │                   │   │                   │   │                   │
    │   • A* pathfinding│   │   • Steering      │   │   • SetFloat()    │
    │   • Dynamic       │   │     behaviors     │   │   • SetTrigger()  │
    │     replanning    │   │   • Separation    │   │   • SetBool()     │
    │   • Obstacle      │   │   • Alignment     │   │   • Animation     │
    │     avoidance     │   │   • Cohesion      │   │     events        │
    │                   │   │   • Flocking      │   │   • IK targets    │
    │   IF NOT:         │   │                   │   │                   │
    │   • Simple        │   │   IF NOT:         │   │                   │
    │     transform     │   │   • Simple        │   │                   │
    │     movement      │   │     velocity      │   │                   │
    │                   │   │     movement      │   │                   │
    └───────────────────┘   └───────────────────┘   └───────────────────┘
    
    
                        DETECTION PATTERN
    
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │   void Awake()                                                         │
    │   {                                                                     │
    │       // Try to find EasyPath                                          │
    │       _pathfinder = GetComponent<EasyPathAgent>();                     │
    │       _hasEasyPath = _pathfinder != null;                              │
    │                                                                         │
    │       // Try to find SwarmAI                                           │
    │       _swarmAgent = GetComponent<SwarmAgent>();                        │
    │       _hasSwarmAI = _swarmAgent != null;                               │
    │                                                                         │
    │       // Animator is required                                          │
    │       _animator = GetComponent<Animator>();                            │
    │   }                                                                     │
    │                                                                         │
    │   void MoveTo(Vector3 destination)                                     │
    │   {                                                                     │
    │       if (_hasEasyPath)                                                │
    │           _pathfinder.SetDestination(destination);                     │
    │       else                                                              │
    │           transform.position = Vector3.MoveTowards(...);               │
    │                                                                         │
    │       if (_hasSwarmAI)                                                 │
    │           _swarmAgent.SetSteering(destination - transform.position);   │
    │   }                                                                     │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

## 8. Emotional State Integration

```
                        EMOTIONAL STATE FLOW
                        
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                          EXTERNAL EVENTS                                │
    │                                                                         │
    │   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐              │
    │   │ Damage   │  │ Spotted  │  │ Ally     │  │ Victory  │              │
    │   │ Taken    │  │ Enemy    │  │ Killed   │  │          │              │
    │   └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘              │
    │        │             │             │             │                     │
    │        ▼             ▼             ▼             ▼                     │
    │   ┌─────────────────────────────────────────────────────────────────┐ │
    │   │                     EMOTIONAL EVENTS                             │ │
    │   │                                                                  │ │
    │   │  DamageEvent:     P:-0.3  A:+0.5  D:-0.2  (Fear/Anger)         │ │
    │   │  SpottedEnemy:    P:-0.1  A:+0.3  D: 0.0  (Alert)              │ │
    │   │  AllyKilled:      P:-0.4  A:+0.4  D:-0.3  (Grief/Fear)         │ │
    │   │  Victory:         P:+0.5  A:+0.2  D:+0.4  (Happy/Confident)    │ │
    │   │                                                                  │ │
    │   └───────────────────────────────┬─────────────────────────────────┘ │
    │                                   │                                    │
    │                                   ▼                                    │
    │   ┌─────────────────────────────────────────────────────────────────┐ │
    │   │                     EMOTIONAL STATE                              │ │
    │   │                                                                  │ │
    │   │   ┌─────────────────────────────────────────────────────────┐  │ │
    │   │   │  Pleasure:   ◀────────●───────────────────▶             │  │ │
    │   │   │             -1       -0.2                   1           │  │ │
    │   │   │                                                         │  │ │
    │   │   │  Arousal:    ◀───────────────────●────────▶             │  │ │
    │   │   │             -1                  +0.6        1           │  │ │
    │   │   │                                                         │  │ │
    │   │   │  Dominance:  ◀──────────●─────────────────▶             │  │ │
    │   │   │             -1         -0.1                 1           │  │ │
    │   │   └─────────────────────────────────────────────────────────┘  │ │
    │   │                                                                  │ │
    │   │   Current Emotion: AFRAID (-P, +A, -D)                          │ │
    │   │   Intensity: 0.63                                               │ │
    │   │                                                                  │ │
    │   │   Baseline Personality: (+0.1, 0.0, +0.2) = Calm Confident     │ │
    │   │   Decay Rate: 0.1 per second                                    │ │
    │   │                                                                  │ │
    │   └───────────────────────────────┬─────────────────────────────────┘ │
    │                                   │                                    │
    │                                   ▼                                    │
    │   ┌─────────────────────────────────────────────────────────────────┐ │
    │   │                UTILITY AI CONSIDERATIONS                         │ │
    │   │                                                                  │ │
    │   │   FleeAction considerations:                                    │ │
    │   │   ┌───────────────────────────────────────────────────────────┐│ │
    │   │   │ EmotionConsideration(Afraid)  ████████░░░░  0.63         ││ │
    │   │   │ HealthConsideration(<30%)     ████████████░  0.85         ││ │
    │   │   │ HasEscapeRoute                ██████████████  1.00        ││ │
    │   │   │                                                           ││ │
    │   │   │ Final Score: 0.63 × 0.85 × 1.0 = 0.54                    ││ │
    │   │   └───────────────────────────────────────────────────────────┘│ │
    │   │                                                                  │ │
    │   │   AttackAction considerations:                                  │ │
    │   │   ┌───────────────────────────────────────────────────────────┐│ │
    │   │   │ EmotionConsideration(Angry)   ████░░░░░░░░  0.30         ││ │
    │   │   │ HealthConsideration(>30%)     █████░░░░░░░  0.40         ││ │
    │   │   │ HasWeapon                     ██████████████  1.00        ││ │
    │   │   │                                                           ││ │
    │   │   │ Final Score: 0.30 × 0.40 × 1.0 = 0.12                    ││ │
    │   │   └───────────────────────────────────────────────────────────┘│ │
    │   │                                                                  │ │
    │   │   Because NPC is AFRAID with high intensity (0.63),            │ │
    │   │   Flee scores higher than Attack → NPC will flee               │ │
    │   │                                                                  │ │
    │   └─────────────────────────────────────────────────────────────────┘ │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

## 9. Guard NPC Archetype Wiring

```
                        GUARD NPC COMPLETE WIRING
                        
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                          GuardNPC Prefab                                │
    │                                                                         │
    │   Components:                                                          │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │ ☑ NPCBrain                                                       │  │
    │   │ ☑ PerceptionSystem                                               │  │
    │   │ ☑ WaypointPath                                                   │  │
    │   │ ☑ Animator                                                       │  │
    │   │ ☐ EasyPathAgent (optional)                                       │  │
    │   │ ☐ SwarmAgent (optional)                                          │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    │   Behavior Tree:                                                       │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │                                                                  │  │
    │   │                         Selector                                 │  │
    │   │                            │                                     │  │
    │   │     ┌──────────────────────┼──────────────────────┐             │  │
    │   │     │                      │                      │             │  │
    │   │     ▼                      ▼                      ▼             │  │
    │   │ ┌────────────┐      ┌────────────┐      ┌────────────┐         │  │
    │   │ │ COMBAT     │      │ INVESTIGATE│      │  PATROL    │         │  │
    │   │ │            │      │            │      │            │         │  │
    │   │ │ Condition: │      │ Condition: │      │ Condition: │         │  │
    │   │ │ TargetVis. │      │ HeardSound │      │ HasWaypoint│         │  │
    │   │ │            │      │            │      │            │         │  │
    │   │ │ Abort:     │      │ Actions:   │      │ Actions:   │         │  │
    │   │ │ LowerPri.  │      │ • LookAt   │      │ • MoveTo   │         │  │
    │   │ │            │      │ • MoveTo   │      │   Waypoint │         │  │
    │   │ │ Actions:   │      │ • Wait 3s  │      │ • Wait 2s  │         │  │
    │   │ │ • UtilityAI│      │ • Return   │      │ • NextWP   │         │  │
    │   │ │   Selector │      │            │      │            │         │  │
    │   │ └────────────┘      └────────────┘      └────────────┘         │  │
    │   │                                                                  │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    │   Utility Actions (Combat):                                            │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │                                                                  │  │
    │   │   Attack:                                                       │  │
    │   │   • InRange consideration (linear)                              │  │
    │   │   • HasAmmo consideration (step)                                │  │
    │   │   • TargetHealth consideration (inverse linear)                 │  │
    │   │                                                                  │  │
    │   │   Chase:                                                        │  │
    │   │   • TargetVisible consideration (step)                          │  │
    │   │   • Distance consideration (inverse exponential)                │  │
    │   │   • Stamina consideration (linear)                              │  │
    │   │                                                                  │  │
    │   │   TakeCover:                                                    │  │
    │   │   • Health consideration (inverse exponential)                  │  │
    │   │   • CoverAvailable consideration (step)                         │  │
    │   │   • UnderFire consideration (step)                              │  │
    │   │                                                                  │  │
    │   │   CallBackup:                                                   │  │
    │   │   • ThreatLevel consideration (exponential)                     │  │
    │   │   • AlliesNearby consideration (inverse linear)                 │  │
    │   │                                                                  │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    │   Blackboard Initial Values:                                           │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │   homePosition = transform.position                             │  │
    │   │   alertLevel = 0                                                │  │
    │   │   health = 100                                                  │  │
    │   │   ammo = 30                                                     │  │
    │   │   patrolRadius = 10                                             │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    │   Perception Settings:                                                 │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │   Sight:                                                        │  │
    │   │   • ViewDistance = 25m                                          │  │
    │   │   • ViewAngle = 90° (focused guard)                             │  │
    │   │   • TargetLayers = "Player", "Enemy"                            │  │
    │   │                                                                  │  │
    │   │   Hearing:                                                      │  │
    │   │   • HearingRange = 20m                                          │  │
    │   │   • SuspicionThreshold = 0.2                                    │  │
    │   │                                                                  │  │
    │   │   Memory:                                                       │  │
    │   │   • MemoryDuration = 30s (guards remember longer)               │  │
    │   │   • MaxMemories = 5                                             │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    │   Emotional Baseline:                                                  │
    │   ┌─────────────────────────────────────────────────────────────────┐  │
    │   │   Pleasure = 0.0  (neutral)                                     │  │
    │   │   Arousal = 0.1   (slightly alert)                              │  │
    │   │   Dominance = 0.4 (confident)                                   │  │
    │   │                                                                  │  │
    │   │   → Guard personality: calm but authoritative                   │  │
    │   └─────────────────────────────────────────────────────────────────┘  │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘
```

---

## 10. State Machine View

```
                        NPC HIGH-LEVEL STATES
                        
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                                                                         │
    │                           ┌───────────┐                                │
    │                           │   IDLE    │                                │
    │                           │           │                                │
    │                           │ Wait at   │                                │
    │                           │ position  │                                │
    │                           └─────┬─────┘                                │
    │                                 │                                       │
    │                    ┌────────────┼────────────┐                         │
    │                    │            │            │                         │
    │            HasWaypoints   HeardSound   TargetVisible                   │
    │                    │            │            │                         │
    │                    ▼            ▼            ▼                         │
    │            ┌───────────┐ ┌───────────┐ ┌───────────┐                  │
    │            │  PATROL   │ │INVESTIGATE│ │  COMBAT   │                  │
    │            │           │ │           │ │           │                  │
    │            │ Follow    │ │ Check out │ │ Fight or  │                  │
    │            │ waypoints │ │ sound     │ │ flee      │                  │
    │            └─────┬─────┘ └─────┬─────┘ └─────┬─────┘                  │
    │                  │             │             │                         │
    │                  │             │             │                         │
    │      ┌───────────┴───────────┐ │ ┌───────────┴───────────┐            │
    │      │                       │ │ │                       │            │
    │      ▼                       ▼ ▼ ▼                       ▼            │
    │   HeardSound            TargetVisible              TargetLost         │
    │      │                       │                       │                │
    │      │                       │                       ▼                │
    │      │                       │              ┌───────────┐             │
    │      │                       │              │  SEARCH   │             │
    │      │                       │              │           │             │
    │      │                       │              │ Look for  │             │
    │      └───────────────────────┤              │ lost      │             │
    │                              │              │ target    │             │
    │                              │              └─────┬─────┘             │
    │                              │                    │                    │
    │                              │         SearchTimeout / FoundTarget    │
    │                              │                    │                    │
    │                              │        ┌───────────┴───────────┐       │
    │                              │        │                       │       │
    │                              │        ▼                       ▼       │
    │                              │   ReturnHome               COMBAT      │
    │                              │        │                               │
    │                              │        ▼                               │
    │                              │   ┌───────────┐                        │
    │                              │   │  RETURN   │                        │
    │                              │   │           │                        │
    │                              │   │ Go back   │                        │
    │                              │   │ to post   │                        │
    │                              │   └─────┬─────┘                        │
    │                              │         │                               │
    │                              │   AtHomePosition                        │
    │                              │         │                               │
    │                              └─────────┼───────────────────────────────│
    │                                        │                               │
    │                                        ▼                               │
    │                                   Back to IDLE                         │
    │                                                                         │
    └─────────────────────────────────────────────────────────────────────────┘


                        STATE TRANSITION TABLE
                        
    ┌────────────┬─────────────────┬───────────────┬─────────────────────────┐
    │ From State │ Trigger         │ To State      │ Action                  │
    ├────────────┼─────────────────┼───────────────┼─────────────────────────┤
    │ IDLE       │ HasWaypoints    │ PATROL        │ Start patrol            │
    │ IDLE       │ HeardSound      │ INVESTIGATE   │ Turn toward sound       │
    │ IDLE       │ TargetVisible   │ COMBAT        │ Alert! Engage target    │
    ├────────────┼─────────────────┼───────────────┼─────────────────────────┤
    │ PATROL     │ HeardSound      │ INVESTIGATE   │ Pause patrol            │
    │ PATROL     │ TargetVisible   │ COMBAT        │ Break patrol, engage    │
    │ PATROL     │ WaypointsComplete│ IDLE         │ Wait at last waypoint  │
    ├────────────┼─────────────────┼───────────────┼─────────────────────────┤
    │ INVESTIGATE│ NothingFound    │ PATROL        │ Resume patrol           │
    │ INVESTIGATE│ TargetVisible   │ COMBAT        │ Engage target           │
    │ INVESTIGATE│ Timeout         │ PATROL        │ Give up, resume patrol  │
    ├────────────┼─────────────────┼───────────────┼─────────────────────────┤
    │ COMBAT     │ TargetLost      │ SEARCH        │ Go to last known pos    │
    │ COMBAT     │ HealthLow       │ FLEE          │ Run away!               │
    │ COMBAT     │ TargetDead      │ RETURN        │ Victory, go home        │
    ├────────────┼─────────────────┼───────────────┼─────────────────────────┤
    │ SEARCH     │ TargetFound     │ COMBAT        │ Re-engage target        │
    │ SEARCH     │ SearchTimeout   │ RETURN        │ Give up, return home    │
    ├────────────┼─────────────────┼───────────────┼─────────────────────────┤
    │ RETURN     │ AtHome          │ IDLE          │ Resume guard duty       │
    │ RETURN     │ TargetVisible   │ COMBAT        │ Spotted again! Engage   │
    │ RETURN     │ HeardSound      │ INVESTIGATE   │ Check it out            │
    ├────────────┼─────────────────┼───────────────┼─────────────────────────┤
    │ FLEE       │ SafeDistance    │ RETURN        │ Got away, go home       │
    │ FLEE       │ Cornered        │ COMBAT        │ Fight (last stand)      │
    └────────────┴─────────────────┴───────────────┴─────────────────────────┘
```

---

## 11. Quick Reference Card

```
    ╔═══════════════════════════════════════════════════════════════════════╗
    ║                     NPCBrain QUICK REFERENCE                          ║
    ╠═══════════════════════════════════════════════════════════════════════╣
    ║                                                                       ║
    ║   PERCEPTION ──▶ BLACKBOARD ──▶ DECISION ──▶ TACTICAL ──▶ ACTION     ║
    ║                                                                       ║
    ╠═══════════════════════════════════════════════════════════════════════╣
    ║                                                                       ║
    ║   PERCEPTION:                                                         ║
    ║   • SightSensor     - FOV + raycast                                  ║
    ║   • HearingSensor   - Range + threshold                              ║
    ║   • Memory          - Decay over time                                 ║
    ║   • TargetSelector  - Weighted scoring                               ║
    ║                                                                       ║
    ╠═══════════════════════════════════════════════════════════════════════╣
    ║                                                                       ║
    ║   KNOWLEDGE:                                                          ║
    ║   • Blackboard      - Key/value store                                ║
    ║   • Emotions        - PAD model (Pleasure/Arousal/Dominance)         ║
    ║   • Beliefs         - What NPC thinks is true                        ║
    ║                                                                       ║
    ╠═══════════════════════════════════════════════════════════════════════╣
    ║                                                                       ║
    ║   DECISION:                                                           ║
    ║   • Behavior Tree   - Structure (Selector/Sequence)                  ║
    ║   • Utility AI      - Scoring (Considerations × Curves)              ║
    ║   • Criticality     - Self-tuning (Temperature/Inertia)              ║
    ║                                                                       ║
    ╠═══════════════════════════════════════════════════════════════════════╣
    ║                                                                       ║
    ║   TACTICAL:                                                           ║
    ║   • Influence Maps  - Threat/Territory/Interest grids               ║
    ║   • Context Steer   - Sample all directions, blend                   ║
    ║   • Cover Analysis  - Find safe positions                            ║
    ║                                                                       ║
    ╠═══════════════════════════════════════════════════════════════════════╣
    ║                                                                       ║
    ║   INTEGRATION:                                                        ║
    ║   • EasyPathBridge  - Pathfinding (optional)                         ║
    ║   • SwarmAIBridge   - Steering behaviors (optional)                  ║
    ║   • AnimatorBridge  - Animation control                              ║
    ║                                                                       ║
    ╠═══════════════════════════════════════════════════════════════════════╣
    ║                                                                       ║
    ║   ARCHETYPES:                                                         ║
    ║   • GuardNPC        - Patrol, investigate, chase, return             ║
    ║   • PatrolNPC       - Follow waypoints, idle animations              ║
    ║   • CivilianNPC     - Wander, flee, cower                            ║
    ║   • EnemyNPC        - Hunt, attack, retreat, search                  ║
    ║                                                                       ║
    ╚═══════════════════════════════════════════════════════════════════════╝
```

---

## Document Index

| Diagram | Purpose |
|---------|---------|
| 1. High-Level Overview | Bird's eye view of the system |
| 2. Complete Component Wiring | All layers and connections |
| 3. Data Flow Per Tick | What happens each update |
| 4. BT + Utility Hybrid | How decision systems work together |
| 5. Perception Pipeline | How NPCs sense the world |
| 6. Criticality Feedback | Adaptive behavior control loop |
| 7. External Integration | EasyPath/SwarmAI/Animator |
| 8. Emotional State | How emotions affect decisions |
| 9. Guard Archetype | Complete example NPC wiring |
| 10. State Machine | High-level state transitions |
| 11. Quick Reference | One-page cheat sheet |
