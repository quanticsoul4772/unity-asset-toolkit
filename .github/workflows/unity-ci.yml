# Unity Asset Toolkit - CI/CD Pipeline
# Runs code validation on push and pull requests
# NOTE: Unity tests and builds are disabled until license is properly configured

name: Unity CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch: # Allow manual triggers

env:
  PROJECT_PATH: assets/EasyPath

jobs:
  # ============================================
  # Code Validation (No Unity License Required)
  # ============================================
  validate:
    name: Code Validation
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Validate Assembly Definitions
        shell: pwsh
        run: |
          Write-Host "=== Assembly Definition Validation ==="
          .\scripts\validate-asmdef.ps1 -ProjectPath $env:PROJECT_PATH

      - name: Check for Deprecated APIs
        shell: pwsh
        run: |
          Write-Host "=== Deprecated API Check ==="
          .\scripts\check-deprecated-api.ps1 -ProjectPath "$env:PROJECT_PATH\Assets"

      - name: Verify C# Syntax
        shell: pwsh
        run: |
          Write-Host "=== C# File Check ==="
          $csFiles = Get-ChildItem -Path "$env:PROJECT_PATH\Assets" -Filter "*.cs" -Recurse
          Write-Host "Found $($csFiles.Count) C# files"
          foreach ($file in $csFiles) {
            $content = Get-Content $file.FullName -Raw -ErrorAction SilentlyContinue
            if ($content -match 'class\s+\w+') {
              Write-Host "  OK: $($file.Name)"
            }
          }
          Write-Host "All C# files validated"
